<%= form_for [refinery, :admin, @setting] do |f| %>

  <%= render '/refinery/admin/error_messages', :object => @setting, :include_object_name => true %>

  <% if action_name =~ /(new)|(create)/ %>
    <div class='field'>
      <%= f.label :name %>
      <%= f.text_field :name, :class => "larger widest" %>
    </div>
  <% end %>

  <% if current_refinery_user.has_role?(:superuser) && @setting.new_record? %>
    <div class='field'>
      <%= f.label :form_value_type %>
      <%= f.select :form_value_type, ::Refinery::Setting::FORM_VALUE_TYPES -%>
    </div>
  <% end %>

  <% unless action_name =~ /(new)|(create)/ or (help = t(@setting.name, :scope => 'refinery.admin.settings.form.help', :default => '')).blank? or @setting.form_value_type == 'check_box'  %>
    <p>
      <span><%= help %></span>
    </p>
  <% end %>

  <div class='field'>
    <%= setting_title(f) %>
    <%= setting_field(f, help) %>
  </div>

  <% locale_scope = "refinery.admin.settings.form.#{@setting.name}" %>
  <p data-locale-scope="<%= "#{locale_scope}.example" %>">
    <%= t("#{locale_scope}.example") %>
  </p>
  <p data-locale-scope="<%= "#{locale_scope}.hint" %>">
    <%= t("#{locale_scope}.hint") %>
  </p>

  <% if current_refinery_user.has_role?(:superuser) %>
    <div class='field'>
      <%= f.check_box :restricted %>
      <%= f.label :restricted, t('.yes_make_this_setting_restricted'), :class => 'stripped',
          :title => t('restricted', :scope => 'refinery.admin.settings.form.help') %>
    </div>
  <% end %>


  <%= render '/refinery/admin/form_actions', :f => f,
             :continue_editing => false,
             :hide_cancel => from_dialog?,
             :submit_button_title => t('.restart_may_be_in_order_html'),
             :delete_title => t('delete', :scope => 'refinery.admin.settings'),
             :delete_confirmation => t('message', :scope => 'refinery.admin.delete', :title => @setting.title),
             :hide_delete => (@setting.new_record? or !@setting.destroyable or from_dialog?) %>
<% end -%>
<% content_for :javascripts do %>
  <script>
    $('#setting_form_value_type').change(function(e) {
      window.location = location_url + ((location_url.indexOf("?") > -1 ? "&" : "?") + "form_value_type=" + $(this).val());
    });
  </script>
<% end if current_refinery_user.has_role?(:superuser) %>
